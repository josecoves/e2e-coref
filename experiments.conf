# Word embeddings.
glove_300d {
  path = glove.840B.300d.txt
  size = 300
}
glove_300d_filtered {
  path = glove.840B.300d.txt.filtered
  size = 300
}
glove_300d_2w {
  path = glove_50_300_2.txt
  size = 300
}

# Distributed training configurations.
two_local_gpus {
  addresses {
    ps = [localhost:2222]
    worker = [localhost:2223, localhost:2224]
  }
  gpus = [0, 1]
}

# Main configuration.
best {
  # Computation limits.
  max_top_antecedents = 50
  max_training_sentences = 50
  top_span_ratio = 0.4

  # Model hyperparameters.
  filter_widths = [3, 4, 5]
  filter_size = 50
  char_embedding_size = 8
  char_vocab_path = "char_vocab.friends.txt"
  context_embeddings = ${glove_300d_filtered}
  head_embeddings = ${glove_300d_2w}
  contextualization_size = 200
  contextualization_layers = 3
  ffnn_size = 150
  ffnn_depth = 2
  feature_size = 20
  max_span_width = 3
  use_metadata = true
  use_genre = false
  use_features = true
  model_heads = true
  coref_depth = 2
  lm_layers = 3
  lm_size = 1024
  coarse_to_fine = true
  plural_speakers = true
  plural_clusters = true
  singleton_thresh = 0
  singularity = 0.6
  many_antecedents = false
  ln = false
  comb = false
  lncomb = false
  pluants = false
  l = 1
  r = 3
  spk = false
  plot = false

  # Learning hyperparameters.
  max_gradient_norm = 5.0
  lstm_dropout_rate = 0.4
  lexical_dropout_rate = 0.5
  dropout_rate = 0.2
  optimizer = adam
  learning_rate = 0.001
  decay_rate = 0.999
  decay_frequency = 100

  # Other.
  train_path = train.friends.jsonlines
  eval_path = dev.friends.jsonlines
  conll_eval_path = dev.friends.v4_gold_conll
  test_path = test.friends.jsonlines
  conll_test_path = test.friends.v4_gold_conll
  lm_path = elmo_cache.hdf5
  genres = ["bc", "bn", "mz", "nw", "pt", "tc", "wb"]
  eval_frequency = 1000
  report_frequency = 100
  log_root = logs/friends
  cluster = ${two_local_gpus}
  debug = false

}

# For evaluation. Do not use for training (i.e. only for predict.py, evaluate.py, and demo.py). Rename `best` directory to `final`.
final = ${best} {
  context_embeddings = ${glove_300d}
  head_embeddings = ${glove_300d_2w}
  lm_path = ""
  eval_path = test.friends.jsonlines
  conll_eval_path = test.friends.v4_gold_conll
}



# Baselines.
lo = ${best} {
  eval_frequency = 100
  report_frequency = 20
  debug = false
  plural_clusters = true
}
test = ${best} {
  eval_frequency = 1
  report_frequency = 1
  debug = true
}

comb = ${best} {
  comb = true
  debug = true
}
oris = ${best} {
  plural_clusters = false
  train_path = sing_max_train.friends.jsonlines
}
many = ${best} {
  many_antecedents = true
  l = 2
  r = 4
}


ln = ${best} {
  eval_frequency = 500
  ln = true
  l = 2
  r = 4
}
lncomb = ${best} {
  lncomb = true
  ln = true
  l = 2
  r = 4
}
pluants = ${best} {
  pluants = true
  l = 2
  r = 4
}
pmany = ${many} {
  pluants = true
}
ori = ${best} {
  l = 1
  r = 2
}

ln2 = ${ln} {
  ln = true
  l = 2
  r = 4
}
lncomb2 = ${lncomb} {
  lncomb = true
  ln = true
  l = 2
  r = 4
}
pluants2 = ${pluants} {
  pluants = true
  l = 2
  r = 4
}
pmany2 = ${pmany} {
  pluants = true
}
ori2 = ${ori} {
  l = 1
  r = 2
}

pln = ${ln} {
  spk = true
  ln = true
  l = 2
  r = 4
}
plncomb = ${lncomb} {
  spk = true
  lncomb = true
  ln = true
  l = 2
  r = 4
}
ppluants = ${pluants} {
  spk = true
  pluants = true
  l = 2
  r = 4
}
ppmany = ${pmany} {
  spk = true
  pluants = true
}
pori = ${ori} {
  spk = true
  l = 1
  r = 2
}


scomb = ${comb} {
  plural_speakers = false
}
sln = ${ln} {
  plural_speakers = false
  plot = true
  eval_frequency = 1
}
slncomb = ${lncomb} {
  plural_speakers = false
}
sori = ${ori} {
  plural_speakers = false
  plot = true
  eval_frequency = 1
}
soris = ${oris} {
  plural_speakers = false
}
spluants = ${pluants} {
  plural_speakers = false
}

xxmany = ${best} {
  many_antecedents = true
  l = 2
  r = 4
  eval_frequency = 100
}

lnm = ${ln} {
  spk = true
  report_frequency = 100
  eval_frequency = 500
}
lncombm = ${lncomb} {
  spk = true
  report_frequency = 100
  eval_frequency = 500
}
lnd = ${ln} {
  coref_depth = 1
}
lnc = ${lnd} {
  coarse_to_fine = false
}
pluants3 = ${best} {
  pluants = true
  eval_frequency = 100
  l = 2
  r = 4
}

smany = ${many} {
  plural_speakers = false
}
spmany = ${pmany} {
  plural_speakers = false
}

plu1 = ${best} {
  debug = false
  plural_clusters = true
  eval_frequency = 100
  train_path = train.friends.jsonlines
  many_antecedents = true
}
plu1 = ${best} {
  debug = false
  plural_clusters = true
  eval_frequency = 100
  train_path = train.friends.jsonlines
  many_antecedents = false
}
sing_top = ${best} {
  debug = false
  plural_clusters = false
  eval_frequency = 100
  train_path = sing_top_train.friends.jsonlines
  many_antecedents = false
}
ssing_top = ${sing_top} {
  plural_speakers = false
}
sing_top2 = ${sing_top} {
  singularity = 0.6
  many_antecedents = false
  debug = false
  l = 2
  r = 1
}
ssing_top2 = ${sing_top2} {
  plural_speakers = false
}
sing_top3 = ${sing_top} {
  singularity = 0.5
}
ssing_top3 = ${sing_top3} {
  plural_speakers = false
}
hi = ${best} {
  singleton_thresh = 0.1
}
sing_none = ${best} {
  plural_clusters = false
  train_path = sing_none_train.friends.jsonlines
}
sing_min = ${best} {
  plural_clusters = false
  train_path = sing_min_train.friends.jsonlines
}
sing_max = ${best} {
  plural_clusters = false
  train_path = sing_max_train.friends.jsonlines
}
ssing_none = ${sing_none} {
  plural_speakers = false
}
ssing_min = ${sing_min} {
  plural_speakers = false
}
ssing_max = ${sing_max} {
  plural_speakers = false
}
c2f_100_ant = ${best} {
  max_top_antecedents = 100
}
c2f_250_ant = ${best} {
  max_top_antecedents = 250
}
c2f_1_layer = ${best} {
  coref_depth = 2
}
c2f_3_layer = ${best} {
  coref_depth = 3
}
distance_50_ant = ${best} {
  max_top_antecedents = 50
  coarse_to_fine = false
  coref_depth = 1
}
distance_100_ant = ${distance_50_ant} {
  max_top_antecedents = 100
}
distance_250_ant = ${distance_50_ant} {
  max_top_antecedents = 250
}